<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>SCREENY Manager</title>
	<link rel="stylesheet" href="style.css">
</head>
<body>
	<!-- Pixelated background canvas -->
	<canvas id="pixel-background"></canvas>

	<div class="container">
		<!-- Landing Page -->
		<section id="landing-page" class="landing-page">
			<div class="landing-content">
				<h1 class="pixel-title">SCREENY Manager</h1>
				<p class="landing-subtitle">Manage events and schedules for your RGB matrix displays</p>

				<div class="emulator-wrapper landing-emulator">
					<div id="matrix-container" class="matrix-container"></div>
				</div>

				<div class="token-form">
					<h3>Enter GitHub Access Token</h3>
					<form id="token-form" onsubmit="window.handleTokenSubmit(event)">
						<input
							type="password"
							id="landing-token-input"
							placeholder="ghp_xxxxxxxxxxxxxxxxxxxx"
							required
						>
						<button type="submit" class="btn-pixel btn-primary">Unlock App</button>
					</form>
				</div>

				<div class="landing-buttons">
					<button class="btn-pixel btn-secondary" onclick="scrollToAbout()">Learn More</button>
				</div>
			</div>

			<div class="about-section" id="about-section">
				<h2 class="pixel-subtitle">What is SCREENY?</h2>
				<p>A web-based manager for your RGB matrix displays. Create events, manage schedules, and see real-time previews of how they'll look on your 64√ó32 LED matrix.</p>
				
				<div class="features">
					<div class="feature-card">
						<canvas class="feature-icon-canvas" id="calendar-icon" width="48" height="48"></canvas>
						<h3>Events</h3>
						<p>Add and manage ephemeral events with custom text, colors, and icons</p>
					</div>
					<div class="feature-card">
						<canvas class="feature-icon-canvas" id="clock-icon" width="48" height="48"></canvas>
						<h3>Schedules</h3>
						<p>Create daily schedules with time-based activities and progress bars</p>
					</div>
					<div class="feature-card">
						<canvas class="feature-icon-canvas" id="eye-icon" width="48" height="48"></canvas>
						<h3>Live Preview</h3>
						<p>See exactly how your content will appear on the RGB matrix display</p>
					</div>
				</div>

				<button class="btn-pixel btn-primary" onclick="showApp()">Start Managing</button>
			</div>
		</section>

		<!-- Main App (hidden initially) -->
		<div id="main-app" class="main-app hidden">
			<header>
				<h1 class="pixel-title">SCREENY Manager</h1>
				<p>Manage events and schedules for your RGB matrix displays</p>
			</header>

			<nav class="tabs">
				<button class="tab active" data-tab="events">Events</button>
				<button class="tab" data-tab="schedules">Schedules</button>
			</nav>

			<!-- Events Tab -->
			<section id="events-tab" class="tab-content active">
				<h2>Your Events</h2>

				<!-- Event List Section -->
				<div class="event-list-section">
					<div class="event-list-header">
						<h3>Current Events</h3>
						<div class="list-actions">
							<button class="btn-pixel btn-primary" onclick="createNewEvent()">‚ûï New</button>
							<button class="btn-pixel btn-secondary" onclick="loadEvents()">üîÑ Refresh</button>
							<button class="btn-pixel btn-secondary" onclick="clearPastEvents()">üóëÔ∏è Clear Past Events</button>
						</div>
					</div>

					<div id="events-loading" class="loading-message hidden">
						Loading events from GitHub...
					</div>

					<div id="events-error" class="error-message hidden"></div>

					<div id="events-empty" class="empty-message hidden">
						No events found. Click the "+ NEW" button to create your first event!
					</div>

					<div id="events-list" class="events-list"></div>
				</div>

			</section>

			<!-- Event Editor Tab (hidden from navigation but accessible programmatically) -->
			<section id="add-event-tab" class="tab-content">
				<div class="editor-header">
					<h2 id="editor-form-title">Add New Event</h2>
					<button class="btn-pixel btn-secondary" onclick="closeEventEditor()">‚úï Close</button>
				</div>

				<!-- Event Editor -->
				<div class="event-editor">
					<div class="event-form-container">
						<div class="event-form">
							<div class="form-group">
								<label for="editor-event-date">Date *</label>
								<div class="date-input-wrapper">
									<input type="date" id="editor-event-date" required>
									<!-- <span class="date-placeholder">YYYY-MM-DD</span> -->
								</div>
							</div>

							<div class="form-group">
								<label for="editor-event-top">Top Line (max 12 chars) *</label>
								<input type="text" id="editor-event-top" maxlength="12" placeholder="Top line text" required>
								<span class="char-count" id="editor-event-top-count">0/12</span>
							</div>

							<div class="form-group">
								<label for="editor-event-bottom">Bottom Line (max 12 chars) *</label>
								<input type="text" id="editor-event-bottom" maxlength="12" placeholder="Bottom line text" required>
								<span class="char-count" id="editor-event-bottom-count">0/12</span>
							</div>

							<div class="form-group">
								<label for="editor-event-image">Image *</label>
								<select id="editor-event-image" required>
									<option value="">Select an image...</option>
								</select>
							</div>

							<div class="form-group">
								<label for="editor-event-color">Color *</label>
								<select id="editor-event-color" required>
									<option value="MINT">Mint</option>
									<option value="BUGAMBILIA">Bugambilia</option>
									<option value="LILAC">Lilac</option>
									<option value="RED">Red</option>
									<option value="GREEN">Green</option>
									<option value="BLUE">Blue</option>
									<option value="ORANGE">Orange</option>
									<option value="YELLOW">Yellow</option>
									<option value="PURPLE">Purple</option>
									<option value="PINK">Pink</option>
									<option value="AQUA">Aqua</option>
									<option value="WHITE">White</option>
								</select>
								<div class="color-preview" id="editor-event-color-preview"></div>
							</div>

							<div class="form-group">
								<label class="checkbox-option">
									<input type="checkbox" id="editor-event-has-time">
									<span>Specific Time Window (optional)</span>
								</label>
							</div>

							<div id="editor-event-time-fields" class="time-fields hidden">
								<div class="form-group">
									<label for="editor-event-start-hour">Start Hour (0-23)</label>
									<input type="number" id="editor-event-start-hour" min="0" max="23" placeholder="0">
								</div>

								<div class="form-group">
									<label for="editor-event-end-hour">End Hour (0-23)</label>
									<input type="number" id="editor-event-end-hour" min="0" max="23" placeholder="23">
								</div>
							</div>

							<div class="form-actions">
								<button type="button" class="btn-pixel btn-primary" onclick="saveEvent()">Save Event</button>
								<button type="button" class="btn-pixel btn-secondary" onclick="closeEventEditor()">Cancel</button>
							</div>
						</div>

						<div class="event-preview-container">
							<h4>Preview</h4>
							<div class="emulator-wrapper event-emulator">
								<div id="matrix-container-editor" class="matrix-container"></div>
								<div class="mobile-event-preview-square"></div>
							</div>
							<p class="preview-hint">This is how your event will appear on the display</p>
						</div>
					</div>
				</div>
			</section>


		<!-- Schedules Tab -->
		<section id="schedules-tab" class="tab-content">
			<h2>Schedule Manager</h2>
			
			<!-- Schedule List Section -->
			<div class="schedule-list-section">
				<div class="schedule-list-header">
					<h3>Schedule Files</h3>
					<div class="list-actions">
						<button class="btn-pixel btn-primary" onclick="createNewSchedule()">‚ûï New</button>
						<button class="btn-pixel btn-secondary" onclick="loadSchedules()">üîÑ</button>
						<button class="btn-pixel btn-secondary" onclick="clearOldSchedules()">üóëÔ∏è Clear Old</button>
					</div>
				</div>

				<div id="schedules-loading" class="loading-message hidden">Loading schedules...</div>
				<div id="schedules-error" class="error-message hidden"></div>
				<div id="schedules-empty" class="empty-message hidden">No schedules found.</div>
				<div id="schedules-list" class="schedules-list"></div>
			</div>

			<!-- ============================================
				 UPDATED SCHEDULE EDITOR HTML
				 Replace the schedule editor section in index.html
				 ============================================ -->
			
			<!-- Schedule Editor -->
			<div id="schedule-editor" class="schedule-editor hidden">
				<div class="editor-header">
					<h3 id="schedule-editor-title">Edit Schedule</h3>
					<button class="btn-pixel btn-secondary" onclick="closeScheduleEditor()">‚úï Close</button>
				</div>
			
				<div class="schedule-editor-content">
					<!-- Dynamic form populated by JavaScript -->
					<div id="schedule-info-form"></div>
			
					<div class="schedule-items-section">
						<div class="section-header">
							<h4>Schedule Items</h4>
							<button class="btn-pixel btn-primary btn-sm" onclick="addScheduleItem()">‚ûï Add Item</button>
						</div>
						<div id="schedule-items-list"></div>
					</div>
			
					<div class="schedule-editor-layout">
						<div class="timeline-view-section">
							<!-- Mobile day indicator -->
							<div id="mobile-day-indicator" class="mobile-day-indicator">
								<div class="mobile-day-item" data-day="0"><span class="mobile-day-short">Mon</span><span class="mobile-day-full">Monday</span></div>
								<div class="mobile-day-item" data-day="1"><span class="mobile-day-short">Tue</span><span class="mobile-day-full">Tuesday</span></div>
								<div class="mobile-day-item" data-day="2"><span class="mobile-day-short">Wed</span><span class="mobile-day-full">Wednesday</span></div>
								<div class="mobile-day-item" data-day="3"><span class="mobile-day-short">Thu</span><span class="mobile-day-full">Thursday</span></div>
								<div class="mobile-day-item" data-day="4"><span class="mobile-day-short">Fri</span><span class="mobile-day-full">Friday</span></div>
								<div class="mobile-day-item" data-day="5"><span class="mobile-day-short">Sat</span><span class="mobile-day-full">Saturday</span></div>
								<div class="mobile-day-item" data-day="6"><span class="mobile-day-short">Sun</span><span class="mobile-day-full">Sunday</span></div>
							</div>

							<div class="timeline-header">
								<h4>Timeline View</h4>
								<div id="timeline-date-display" class="timeline-date-display hidden"></div>
								<div class="timeline-view-controls">
									<button id="timeline-view-day" class="btn-pixel btn-sm btn-primary" onclick="window.schedulesModule.setTimelineViewMode('day')">Day</button>
									<button id="timeline-view-week" class="btn-pixel btn-sm btn-secondary" onclick="window.schedulesModule.setTimelineViewMode('week')">Week</button>
									<select id="timeline-day-filter" onchange="updateTimelineView()">
										<option value="0">Monday</option>
										<option value="1">Tuesday</option>
										<option value="2">Wednesday</option>
										<option value="3">Thursday</option>
										<option value="4">Friday</option>
										<option value="5">Saturday</option>
										<option value="6">Sunday</option>
									</select>
								</div>
							</div>
							<div id="timeline-view" class="timeline-view"></div>
							<div id="timeline-week-view" class="timeline-week-view hidden"></div>
						</div>
						<div class="schedule-preview-section">
							<h4>Preview</h4>
							<div class="schedule-preview-controls">
								<select id="preview-item-select" onchange="window.schedulesModule.updateSchedulePreview()">
									<option value="">Select item to preview...</option>
								</select>
							</div>
							<div class="emulator-wrapper schedule-emulator">
								<div id="matrix-container-schedule"></div>
								<div class="mobile-preview-square"></div>
							</div>

							<!-- Mobile Edit Panel -->
							<div id="mobile-edit-panel" class="mobile-edit-panel">
								<div class="edit-panel-header">
									<h5>Edit Item</h5>
								</div>
								<div class="edit-panel-content">
									<div class="form-group">
										<label for="mobile-edit-item-name">Item Name</label>
										<input type="text" id="mobile-edit-item-name" placeholder="Item name" onchange="window.schedulesModule.liveUpdateItemMobile('name', this.value)">
									</div>

									<div class="form-group">
										<label class="checkbox-option">
											<input type="checkbox" id="mobile-edit-item-enabled" onchange="window.schedulesModule.liveUpdateItemMobile('enabled', this.checked)">
											<span>Enabled</span>
										</label>
									</div>

									<div class="form-group" id="mobile-edit-days-group">
										<label>Days of Week</label>
										<div class="day-checkboxes">
											<label class="day-checkbox">
												<input type="checkbox" id="mobile-edit-day-0" value="0" onchange="window.schedulesModule.liveUpdateDaysMobile()">
												Mon
											</label>
											<label class="day-checkbox">
												<input type="checkbox" id="mobile-edit-day-1" value="1" onchange="window.schedulesModule.liveUpdateDaysMobile()">
												Tue
											</label>
											<label class="day-checkbox">
												<input type="checkbox" id="mobile-edit-day-2" value="2" onchange="window.schedulesModule.liveUpdateDaysMobile()">
												Wed
											</label>
											<label class="day-checkbox">
												<input type="checkbox" id="mobile-edit-day-3" value="3" onchange="window.schedulesModule.liveUpdateDaysMobile()">
												Thu
											</label>
											<label class="day-checkbox">
												<input type="checkbox" id="mobile-edit-day-4" value="4" onchange="window.schedulesModule.liveUpdateDaysMobile()">
												Fri
											</label>
											<label class="day-checkbox">
												<input type="checkbox" id="mobile-edit-day-5" value="5" onchange="window.schedulesModule.liveUpdateDaysMobile()">
												Sat
											</label>
											<label class="day-checkbox">
												<input type="checkbox" id="mobile-edit-day-6" value="6" onchange="window.schedulesModule.liveUpdateDaysMobile()">
												Sun
											</label>
										</div>
									</div>

									<div class="form-group">
										<label>Start Time</label>
										<div class="time-row">
											<div class="time-field">
												<label for="mobile-edit-start-hour">Hour</label>
												<input type="number" id="mobile-edit-start-hour" min="0" max="23" placeholder="00" onchange="window.schedulesModule.liveUpdateItemMobile('startHour', parseInt(this.value))">
											</div>
											<div class="time-field">
												<label for="mobile-edit-start-min">Min</label>
												<input type="number" id="mobile-edit-start-min" min="0" max="59" placeholder="00" onchange="window.schedulesModule.liveUpdateItemMobile('startMin', parseInt(this.value))">
											</div>
										</div>
									</div>

									<div class="form-group">
										<label>End Time</label>
										<div class="time-row">
											<div class="time-field">
												<label for="mobile-edit-end-hour">Hour</label>
												<input type="number" id="mobile-edit-end-hour" min="0" max="23" placeholder="00" onchange="window.schedulesModule.liveUpdateItemMobile('endHour', parseInt(this.value))">
											</div>
											<div class="time-field">
												<label for="mobile-edit-end-min">Min</label>
												<input type="number" id="mobile-edit-end-min" min="0" max="59" placeholder="00" onchange="window.schedulesModule.liveUpdateItemMobile('endMin', parseInt(this.value))">
											</div>
										</div>
									</div>

									<div class="form-group">
										<label for="mobile-edit-item-image">Image</label>
										<select id="mobile-edit-item-image" onchange="window.schedulesModule.liveUpdateItemMobile('image', this.value)">
											<option value="">Select image...</option>
										</select>
									</div>

									<div class="form-group">
										<label class="checkbox-option">
											<input type="checkbox" id="mobile-edit-item-progressbar" onchange="window.schedulesModule.liveUpdateItemMobile('progressBar', this.checked)">
											<span>Show Progress Bar</span>
										</label>
									</div>

									<div class="form-group">
										<button class="btn-pixel btn-danger" onclick="window.schedulesModule.deleteScheduleItemFromPanelMobile()">Delete Item</button>
									</div>
								</div>
							</div>

							<!-- Edit Panel -->
							<div id="timeline-edit-panel" class="timeline-edit-panel hidden">
								<div class="edit-panel-header">
									<h5>Edit Item</h5>
									<input type="text" id="edit-item-name" class="form-input" placeholder="Item name" onchange="window.schedulesModule.liveUpdateItem('name', this.value)">
									<label>
										<input type="checkbox" id="edit-item-enabled" onchange="window.schedulesModule.liveUpdateItem('enabled', this.checked)">
										Enabled
									</label>
									<button class="btn-pixel btn-sm btn-danger" onclick="window.schedulesModule.deleteScheduleItemFromPanel()">Delete</button>
								</div>
								<div class="edit-panel-content">
									<div class="form-group-small" id="edit-days-group">
										<div class="days-checkboxes">
											<label class="day-checkbox-sm"><input type="checkbox" id="edit-day-0" value="0" onchange="window.schedulesModule.liveUpdateDays()"> Mon</label>
											<label class="day-checkbox-sm"><input type="checkbox" id="edit-day-1" value="1" onchange="window.schedulesModule.liveUpdateDays()"> Tue</label>
											<label class="day-checkbox-sm"><input type="checkbox" id="edit-day-2" value="2" onchange="window.schedulesModule.liveUpdateDays()"> Wed</label>
											<label class="day-checkbox-sm"><input type="checkbox" id="edit-day-3" value="3" onchange="window.schedulesModule.liveUpdateDays()"> Thu</label>
											<label class="day-checkbox-sm"><input type="checkbox" id="edit-day-4" value="4" onchange="window.schedulesModule.liveUpdateDays()"> Fri</label>
											<label class="day-checkbox-sm"><input type="checkbox" id="edit-day-5" value="5" onchange="window.schedulesModule.liveUpdateDays()"> Sat</label>
											<label class="day-checkbox-sm"><input type="checkbox" id="edit-day-6" value="6" onchange="window.schedulesModule.liveUpdateDays()"> Sun</label>
										</div>
									</div>
									<div class="form-group-small">
										<div class="edit-time-inputs">
											<span>Running From: </span>
											<input type="number" id="edit-start-hour" class="time-input" min="0" max="23" placeholder="00" onchange="window.schedulesModule.liveUpdateItem('startHour', parseInt(this.value))">
											<span>:</span>
											<input type="number" id="edit-start-min" class="time-input" min="0" max="59" placeholder="00" onchange="window.schedulesModule.liveUpdateItem('startMin', parseInt(this.value))">
											<span>to</span>
											<input type="number" id="edit-end-hour" class="time-input" min="0" max="23" placeholder="00" onchange="window.schedulesModule.liveUpdateItem('endHour', parseInt(this.value))">
											<span>:</span>
											<input type="number" id="edit-end-min" class="time-input" min="0" max="59" placeholder="00" onchange="window.schedulesModule.liveUpdateItem('endMin', parseInt(this.value))">
										</div>
									</div>
									<div class="form-group-small">
										<label for="edit-item-image">Image:</label>
										<select id="edit-item-image" class="form-input" onchange="window.schedulesModule.liveUpdateItem('image', this.value)">
											<option value="">Select image...</option>
										</select>
										<label>
											<input type="checkbox" id="edit-item-progressbar" onchange="window.schedulesModule.liveUpdateItem('progressBar', this.checked)">
											Show Progress Bar
										</label>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- Mobile Preview Square -->
					<div class="mobile-schedule-preview">
						<div id="mobile-schedule-preview-matrix"></div>
					</div>

					<div class="schedule-actions">
						<button class="btn-pixel btn-primary" onclick="saveSchedule()">üíæ Save Schedule</button>
						<button class="btn-pixel btn-secondary" onclick="window.schedulesModule.saveAsTemplate()">üìÑ Save as Template</button>
						<button class="btn-pixel btn-secondary" onclick="closeScheduleEditor()">Cancel</button>
					</div>
				</div>
			</div>
		</section>

		<!-- Template Manager Modal -->
		<div id="template-manager-modal" class="modal hidden">
			<div class="modal-content template-manager-content">
				<div class="modal-header">
					<h3>Template Manager</h3>
					<button class="modal-close" onclick="window.templateManager.closeTemplateManager()">√ó</button>
				</div>
				<div class="modal-body">
					<div id="template-manager-loading" class="loading-message hidden">Loading templates...</div>
					<div id="template-manager-error" class="error-message hidden"></div>
					<div id="template-manager-empty" class="empty-message hidden">No templates found. Save a schedule as a template to get started!</div>
					<div id="template-list" class="template-list"></div>
				</div>
			</div>
		</div>

		<!-- Validation Modal -->
		<div id="validation-modal" class="modal hidden">
			<div class="modal-content validation-modal-content">
				<div class="modal-header">
					<h3>Data Validation</h3>
					<button class="modal-close" onclick="window.closeValidationModal()">√ó</button>
				</div>
				<div class="modal-body">
					<div id="validation-status" class="validation-status">Starting validation...</div>
					<div id="validation-results" class="validation-results"></div>
				</div>
				<div class="modal-footer">
					<button class="btn-pixel btn-secondary" onclick="window.closeValidationModal()">Close</button>
				</div>
			</div>
		</div>

		<footer class="app-footer">
			<div class="footer-left">
				<span class="footer-version">SCREENY Manager v1.3.0</span>
				<a href="https://github.com/strategeekal/pantallita-events" target="_blank" class="footer-link">Data</a>
				<a href="https://github.com/strategeekal/pantallita-manager" target="_blank" class="footer-link">Code</a>
				<span class="footer-separator">|</span>
				<a href="#" class="footer-link" onclick="window.templateManager.openTemplateManager(); return false;">Template Manager</a>
				<span class="footer-separator">|</span>
				<a href="#" class="footer-link validation-link" onclick="window.runValidation(); return false;">
					üîç Validate Data
					<span id="validation-badge" class="validation-badge hidden"></span>
				</a>
			</div>
			<div class="footer-right">
				<button class="btn-logout-footer" onclick="window.logout()">Logout</button>
			</div>
		</footer>

		</div>

		<div id="status" class="status hidden"></div>
	</div>

	<!-- ES6 Modules - Mobile optimized -->
	<script type="module" src="js/ui/fonts.js"></script>
	<script type="module" src="js/main.js"></script>

	<!-- Fallback for older browsers -->
	<script nomodule>
		alert('Your browser does not support ES6 modules. Please use a modern browser like Chrome, Firefox, Safari, or Edge.');
	</script>
</body>
</html>
